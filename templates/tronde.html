<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Trá»™n Ä‘á» thi XUKA</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <style>
  
    textarea {
      width: 100%;
      height: 300px;
      font-family: monospace;
      margin-bottom: 12px;
    }
    button {
      margin-right: 8px;
      padding: 6px 12px;
    }
  </style>
</head>
<body>
  <h2>ğŸ‘©â€ğŸ« Äá»€ Gá»C </h2>
  <textarea id="inputDeGoc" placeholder="DÃ¡n Ä‘á» gá»‘c táº¡i Ä‘Ã¢y - táº¡o 24 Ä‘á»"></textarea>
  <br>
  <button onclick="luuDe()">ğŸ’¾ LÆ°u Ä‘á»</button>
  <button onclick="tronDe()">ğŸ” Trá»™n Ä‘á» & Táº£i vá»</button>
  <p id="status"></p>

  <script>
  
    let deGoc = [];

    function luuDe() {
      try {
        const input = document.getElementById('inputDeGoc').value;
        const json = JSON.parse(input);
        if (!Array.isArray(json)) throw new Error("Pháº£i lÃ  máº£ng JSON");
        deGoc = json;
        document.getElementById('status').textContent = 'âœ… ÄÃ£ lÆ°u Ä‘á» gá»‘c thÃ nh cÃ´ng!';
      } catch (e) {
        document.getElementById('status').textContent = 'âŒ Lá»—i JSON: ' + e.message;
      }
    }

    async function tronDe() {
      if (!Array.isArray(deGoc) || deGoc.length === 0) {
        document.getElementById('status').textContent = 'âš ï¸ ChÆ°a cÃ³ Ä‘á» gá»‘c!';
        return;
      }

      const status = document.getElementById('status');
      status.textContent = 'â³ Äang trá»™n vÃ  táº¡o file ZIP...';

      const allTests = [];

      for (let i = 1; i <= 24; i++) {
        const deTron = JSON.parse(JSON.stringify(deGoc));
        shuffleArray(deTron);

        deTron.forEach((cau, index) => {
          const dapAnCu = cau.lua_chon[cau.dap_an_dung];
          const luaChonArray = Object.entries(cau.lua_chon);
          shuffleArray(luaChonArray);

          const newLuaChon = {};
          let newDapAn = '';
          const keys = ['A', 'B', 'C', 'D'];

          luaChonArray.forEach(([_, val], idx) => {
            newLuaChon[keys[idx]] = val;
            if (val === dapAnCu) newDapAn = keys[idx];
          });

          const noiDungGoc = cau.noi_dung.replace(/^CÃ¢u\s*\d+[:.]\s*/, '').trim();
          cau.noi_dung = `CÃ¢u ${index + 1}: ${noiDungGoc}`;
          cau.lua_chon = newLuaChon;
          cau.dap_an_dung = newDapAn;
        });

        allTests.push({ de_so: i, noi_dung_de: deTron });
      }

      // NÃ©n thÃ nh .zip
      const zip = new JSZip();
      allTests.forEach(test => {
        zip.file(`de_${test.de_so.toString().padStart(2, '0')}.json`, JSON.stringify(test.noi_dung_de, null, 2));
      });

      try {
        const blob = await zip.generateAsync({ type: 'blob' });

        // Táº¡o link táº£i vá»
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'de_thi_24.zip';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);

        status.textContent = 'âœ… ÄÃ£ trá»™n vÃ  táº£i file ZIP vá» thÃ nh cÃ´ng!';
      } catch (err) {
        status.textContent = 'âŒ Lá»—i khi táº¡o file ZIP: ' + err.message;
      }
    }

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }
  </script>
  <script src="js/fix-svg-viewbox.js"></script>

</body>
<h2>ğŸ‘©â€ğŸ« SOáº N Äá»€ MáºªU THEO Cáº¤U TRÃšC SAU</h2>
<pre style="background:#f4f4f4;padding:1em;border:1px solid #ccc;">
[
  {
    "noi_dung": "CÃ¢u 1. HÃ m sá»‘ nÃ o sau Ä‘Ã¢y lÃ  hÃ m sá»‘ báº­c hai?",
    "lua_chon": {"A": "y = 2x + 3", "B": "y = x^2 + 2x + 1", "C": "y = 1/x", "D": "y = âˆšx"},
    "dap_an_dung": "B"
  },
  {
    "noi_dung": "CÃ¢u 2. GiÃ¡ trá»‹ cá»§a biá»ƒu thá»©c |âˆ’5| lÃ  bao nhiÃªu?",
    "lua_chon": {"A": "5", "B": "âˆ’5", "C": "0", "D": "10"},
    "dap_an_dung": "A"
  },
  {
    "noi_dung": "CÃ¢u 3. PhÆ°Æ¡ng trÃ¬nh nÃ o sau Ä‘Ã¢y cÃ³ hai nghiá»‡m phÃ¢n biá»‡t?",
    "lua_chon": {"A": "x^2 - 4x + 4 = 0", "B": "x^2 + 1 = 0", "C": "x^2 - 5x + 6 = 0", "D": "x^2 = 0"},
    "dap_an_dung": "C"
  },
  ........
]
</pre>


</html>
